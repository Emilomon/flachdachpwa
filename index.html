<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Wir zwei ‚Äì Check-in App</title>

  <!-- PWA (Android/General) -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0d1025" />

  <!-- PWA (Apple/iOS) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon-180.png" />

  <style>
    :root{
      --bg:#0d1025;--panel:#151a32;--ink:#e9edff;--muted:#a8b2d6;--accent:#7dd6ff;--accent-2:#b3ffdc;--card:#1b2040;--outline:#2c3358;--shadow:0 18px 56px rgba(8,12,32,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{background:radial-gradient(circle at 20% 20%,rgba(125,214,255,.15),transparent 28%),radial-gradient(circle at 80% 0%,rgba(179,255,220,.16),transparent 30%),var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Inter,Arial,sans-serif;padding:12px;display:flex;justify-content:center}
    .shell{width:min(1200px,98vw);margin:auto}
    .hero{background:linear-gradient(135deg,rgba(125,214,255,.24),rgba(179,255,220,.14));border:1px solid rgba(255,255,255,.1);border-radius:22px;padding:18px 18px 16px;box-shadow:var(--shadow)}
    header{display:flex;flex-wrap:wrap;gap:12px;justify-content:space-between;align-items:flex-start}
    h1{margin:0;font-size:clamp(22px,4vw,30px);letter-spacing:-0.3px}
    p{margin:0;color:var(--muted);line-height:1.5}
    .eyebrow{font-size:12px;letter-spacing:1px;text-transform:uppercase;color:#9fd9ff;margin-bottom:4px;font-weight:700}
    .badges{display:flex;flex-wrap:wrap;gap:8px}
    .badge{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:8px 10px;font-variant-numeric:tabular-nums;color:var(--ink);display:flex;align-items:center;gap:6px}
    .layout{margin-top:14px;display:grid;grid-template-columns:1.1fr 0.9fr;gap:14px}
    .panel{background:var(--card);border:1px solid var(--outline);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:12px;box-shadow:var(--shadow)}
    label{font-weight:700;color:var(--ink);display:block;margin-bottom:4px}
    textarea, input[type="text"]{width:100%;border-radius:12px;border:1px solid var(--outline);background:#0f1329;color:var(--ink);padding:10px;font-size:14px;font-family:inherit;outline:none;transition:border .15s ease,box-shadow .15s ease}
    textarea:focus, input[type="text"]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(125,214,255,.14)}
    textarea{min-height:120px;resize:vertical}
    .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;align-items:end}
    .subtle{color:var(--muted);font-size:13px}
    .moods{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:8px}
    .mood{border:1px solid var(--outline);border-radius:12px;padding:10px;cursor:pointer;display:flex;align-items:center;gap:10px;background:#0f1329;transition:border .15s ease,transform .1s ease}
    .mood input{display:none}
    .mood strong{font-size:16px}
    .mood small{color:var(--muted)}
    .mood[data-active="true"]{border-color:var(--accent);box-shadow:0 0 0 3px rgba(125,214,255,.12);transform:translateY(-1px)}
    button{appearance:none;background:linear-gradient(120deg,#7dd6ff,#b3ffdc);border:none;color:#0b1228;font-weight:800;border-radius:12px;padding:12px 14px;font-size:14px;cursor:pointer;box-shadow:0 10px 30px rgba(125,214,255,.26);transition:transform .1s ease,box-shadow .1s ease}
    button:active{transform:translateY(1px);box-shadow:0 6px 18px rgba(125,214,255,.26)}
    .ghost{background:rgba(255,255,255,.05);color:var(--ink);border:1px solid var(--outline);box-shadow:none}
    .switches{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:8px}
    .pill{padding:10px 12px;border-radius:12px;border:1px solid var(--outline);background:#0f1329;color:var(--ink);display:flex;align-items:center;justify-content:space-between;gap:10px}
    .list{display:flex;flex-direction:column;gap:10px;max-height:520px;overflow:auto;padding-right:6px}
    .entry{border:1px solid var(--outline);border-radius:14px;padding:12px;background:#0f1329;display:grid;grid-template-columns:auto 1fr;gap:10px}
    .entry .tag{padding:6px 10px;border-radius:10px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);font-weight:700;display:inline-flex;align-items:center;gap:6px}
    .entry small{color:var(--muted)}
    .questions{display:grid;gap:8px}
    .question{padding:10px 12px;border-radius:10px;border:1px dashed var(--outline);background:rgba(255,255,255,.04)}
    .section-title{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .section-title h2{margin:0;font-size:18px}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--outline);color:var(--ink);background:rgba(255,255,255,.05);cursor:pointer;transition:border .12s ease}
    .chip[data-active="true"]{border-color:var(--accent);background:rgba(125,214,255,.14);color:#0b1228}
    .summary-card{border:1px solid var(--outline);border-radius:14px;padding:12px;background:#0f1329;display:flex;flex-direction:column;gap:8px}
    @media (max-width:900px){body{padding:8px}.layout{grid-template-columns:1fr}.list{max-height:none}}
  </style>
</head>
<body>
  <div class="shell">
    <div class="hero">
      <header>
        <div>
          <div class="eyebrow">Zweisam, auch wenn wenig Zeit ist</div>
          <h1>Unser Check-in</h1>
          <p>Teilt eure Stimmung, legt Themen ab und lasst euch kurze Fragen vorschlagen. So bleibt ihr verbunden, auch wenn die Zeit knapp ist.</p>
        </div>
        <div class="badges">
          <div class="badge">PWA ¬∑ offlinef√§hig</div>
          <div class="badge" id="lastUpdate">Keine Eintr√§ge</div>
        </div>
      </header>
    </div>

    <div class="layout" aria-live="polite">
      <div class="panel">
        <div class="section-title">
          <h2>Check-in schreiben</h2>
          <button id="saveBtn" type="button">Sichern & teilen</button>
        </div>
        <div class="row">
          <div>
            <label for="meName">Dein Name</label>
            <input id="meName" type="text" placeholder="z. B. Anna" autocomplete="name">
          </div>
          <div>
            <label for="partnerName">Name deines Partners/deiner Partnerin</label>
            <input id="partnerName" type="text" placeholder="z. B. Ben" autocomplete="name">
          </div>
        </div>
        <div>
          <label>Wie f√ºhlst du dich?</label>
          <div class="moods" id="moodList"></div>
        </div>
        <div class="row">
          <div class="pill">
            <div>
              <strong>Energie</strong>
              <div class="subtle">Wieviel Kapazit√§t hast du gerade?</div>
            </div>
            <input id="energy" type="range" min="1" max="10" value="5">
          </div>
          <div class="pill">
            <div>
              <strong>Gespr√§chswunsch</strong>
              <div class="subtle">Soll der andere reagieren?</div>
            </div>
            <select id="talkIntent" style="width:140px;border-radius:10px;border:1px solid var(--outline);background:#0f1329;color:var(--ink);padding:8px">
              <option value="wenn Zeit">Wenn Zeit ist</option>
              <option value="bitte melden">Bitte bald melden</option>
              <option value="nur Info">Nur Info</option>
            </select>
          </div>
        </div>
        <div>
          <label for="topic">Thema festhalten</label>
          <textarea id="topic" placeholder="Was m√∂chtest du sp√§ter teilen oder besprechen?"></textarea>
          <div class="subtle">Kurz & einfach reicht. Der Eintrag bleibt gespeichert, bis ihr ihn abhakt.</div>
        </div>
        <div class="section-title">
          <h2>KI-Fragen f√ºr heute</h2>
          <button id="refreshQuestions" type="button" class="ghost">Neue Fragen holen</button>
        </div>
        <div class="questions" id="questionBox"></div>
      </div>

      <div class="panel">
        <div class="section-title">
          <h2>Offene Themen</h2>
          <div class="chips" id="filters"></div>
        </div>
        <div class="list" id="entryList"></div>
        <div class="section-title">
          <h2>Zusammenfassung f√ºr deinen Partner</h2>
          <button id="copySummary" type="button" class="ghost">In Zwischenablage kopieren</button>
        </div>
        <div class="summary-card" id="summaryCard">
          <strong>Keine Eintr√§ge vorhanden</strong>
          <div class="subtle">Sobald du einen Check-in speicherst, erscheint hier eine kurze Zusammenfassung, die du z.‚ÄØB. per Messenger teilen kannst.</div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const STORAGE_KEY = 'tandem-checkins-v1';
  const moodList = document.getElementById('moodList');
  const entryList = document.getElementById('entryList');
  const filters = document.getElementById('filters');
  const questionBox = document.getElementById('questionBox');
  const lastUpdate = document.getElementById('lastUpdate');
  const summaryCard = document.getElementById('summaryCard');
  const meNameInput = document.getElementById('meName');
  const partnerNameInput = document.getElementById('partnerName');

  const moods = [
    { id:'ruhig', label:'Ruhig', emoji:'üåø', tone:'ausgeglichen' },
    { id:'gestresst', label:'Gestresst', emoji:'‚ö°Ô∏è', tone:'unter Strom' },
    { id:'m√ºde', label:'M√ºde', emoji:'üò¥', tone:'ersch√∂pft' },
    { id:'freudig', label:'Freudig', emoji:'‚ú®', tone:'positiv' },
    { id:'genervt', label:'Genervt', emoji:'üôÑ', tone:'gereizt' },
    { id:'dankbar', label:'Dankbar', emoji:'ü§ç', tone:'zugewandt' },
  ];

  const questionPool = {
    ruhig: [
      'Was hat dir heute Ruhe gegeben?',
      'Gibt es etwas, das du gern so beibehalten m√∂chtest?',
      'Welche Kleinigkeit k√∂nnen wir heute teilen?'
    ],
    gestresst: [
      'Was frisst gerade die meiste Energie?',
      'Wobei w√ºrdest du dir kurze Unterst√ºtzung w√ºnschen?',
      'Was k√∂nnte dir helfen, einmal durchzuatmen?'
    ],
    m√ºde: [
      'Was hat dich heute ersch√∂pft?',
      'Was braucht heute keinen Perfektionismus?',
      'Gibt es etwas, das du verschieben kannst?'
    ],
    freudig: [
      'Was hat dich heute gefreut?',
      'Wen m√∂chtest du an deiner Freude teilhaben lassen?',
      'Was k√∂nnen wir davon festhalten?'
    ],
    genervt: [
      'Was nervt dich konkret?',
      'Braucht es nur Geh√∂r oder eine L√∂sung?',
      'Was w√§re ein kleiner Schritt, der Druck rausnimmt?'
    ],
    dankbar: [
      'Wof√ºr bist du heute dankbar?',
      'M√∂chtest du jemandem Danke sagen?',
      'Welche Geste hat dich ber√ºhrt?'
    ],
    fallback: [
      'Welche √úberschrift h√§tte dein Tag?',
      'Was darf dein Partner jetzt √ºber dich wissen?',
      'Wie kann man dir heute etwas Gutes tun?'
    ]
  };

  const defaultState = {
    entries: [],
    lastMood: 'ruhig',
    meName: '',
    partnerName: ''
  };

  let state = load();
  hydrateForm();
  renderMoods();
  renderFilters();
  renderEntries();
  refreshQuestions();

  document.getElementById('saveBtn').addEventListener('click', saveEntry);
  document.getElementById('refreshQuestions').addEventListener('click', refreshQuestions);
  document.getElementById('copySummary').addEventListener('click', copySummary);
  meNameInput.addEventListener('input', () => { state.meName = meNameInput.value.trim(); persist(); renderFilters(); renderEntries(); });
  partnerNameInput.addEventListener('input', () => { state.partnerName = partnerNameInput.value.trim(); persist(); renderFilters(); renderEntries(); });

  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return {...defaultState};
      return { ...defaultState, ...JSON.parse(raw) };
    }catch(e){
      return {...defaultState};
    }
  }

  function persist(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  }

  function hydrateForm(){
    meNameInput.value = state.meName;
    partnerNameInput.value = state.partnerName;
    document.getElementById('energy').value = 5;
    document.getElementById('topic').value = '';
    document.getElementById('talkIntent').value = 'wenn Zeit';
  }

  function renderMoods(){
    moodList.innerHTML = '';
    moods.forEach(m => {
      const label = document.createElement('label');
      label.className = 'mood';
      label.dataset.active = m.id === state.lastMood;

      const input = document.createElement('input');
      input.type = 'radio';
      input.name = 'mood';
      input.value = m.id;
      input.checked = m.id === state.lastMood;
      input.addEventListener('change', () => {
        state.lastMood = m.id;
        persist();
        renderMoods();
        refreshQuestions();
      });

      const icon = document.createElement('div');
      icon.style.fontSize = '22px';
      icon.textContent = m.emoji;

      const text = document.createElement('div');
      const strong = document.createElement('strong');
      strong.textContent = m.label;
      const small = document.createElement('small');
      small.textContent = `Gef√ºhl: ${m.tone}`;
      text.append(strong, document.createElement('br'), small);

      label.append(input, icon, text);
      moodList.appendChild(label);
    });
  }

  function renderFilters(){
    filters.innerHTML = '';
    const names = [state.meName || 'Ich', state.partnerName || 'Partner'];
    ['alle', ...names].forEach(f => {
      const chip = document.createElement('button');
      chip.type = 'button';
      chip.className = 'chip';
      chip.textContent = f === 'alle' ? 'Alle Eintr√§ge' : f;
      chip.dataset.value = f;
      chip.dataset.active = state.filter === f || (!state.filter && f === 'alle');
      chip.addEventListener('click', () => {
        state.filter = f === 'alle' ? null : f;
        persist();
        renderFilters();
        renderEntries();
      });
      filters.appendChild(chip);
    });
  }

  function renderEntries(){
    entryList.innerHTML = '';
    const list = state.entries
      .filter(e => !state.filter || e.author === state.filter)
      .sort((a,b)=>b.createdAt-a.createdAt);

    if(list.length === 0){
      const empty = document.createElement('div');
      empty.className = 'subtle';
      empty.textContent = 'Noch keine Eintr√§ge. Schreib den ersten Check-in!';
      entryList.appendChild(empty);
      summaryCard.innerHTML = '<strong>Keine Eintr√§ge vorhanden</strong><div class="subtle">Sobald du einen Check-in speicherst, erscheint hier eine kurze Zusammenfassung.</div>';
      lastUpdate.textContent = 'Keine Eintr√§ge';
      return;
    }

    const formatter = new Intl.DateTimeFormat('de-DE',{hour:'2-digit',minute:'2-digit',day:'2-digit',month:'short'});

    list.forEach(entry => {
      const node = document.createElement('div');
      node.className = 'entry';

      const tag = document.createElement('div');
      tag.className = 'tag';
      tag.textContent = `${entry.emoji} ${entry.moodLabel}`;

      const body = document.createElement('div');
      const headerLine = document.createElement('div');
      const author = document.createElement('strong');
      author.textContent = entry.author;
      const time = document.createElement('small');
      time.textContent = formatter.format(entry.createdAt);
      headerLine.append(author, document.createTextNode(' ¬∑ '), time);

      const infoLine = document.createElement('div');
      const info = document.createElement('small');
      info.textContent = `Energie: ${entry.energy}/10 ¬∑ Wunsch: ${entry.talkIntent}`;
      infoLine.append(info);

      const topicLine = document.createElement('div');
      topicLine.style.marginTop = '6px';
      if(entry.topic){
        topicLine.textContent = entry.topic;
      } else {
        const empty = document.createElement('span');
        empty.className = 'subtle';
        empty.textContent = 'Kein Text';
        topicLine.append(empty);
      }

      body.append(headerLine, infoLine, topicLine);

      node.append(tag, body);
      entryList.appendChild(node);
    });

    const latest = list[0];
    lastUpdate.textContent = 'Letzter Eintrag: ' + formatter.format(latest.createdAt);
    summaryCard.innerHTML = '';
    const summaryTitle = document.createElement('strong');
    summaryTitle.textContent = `Kurzinfo f√ºr ${state.partnerName || 'deinen Partner'}`;
    const summaryText = document.createElement('div');
    summaryText.textContent = buildSummary(latest);
    summaryCard.append(summaryTitle, summaryText);
  }

  function saveEntry(){
    const author = meNameInput.value.trim() || 'Ich';
    const partner = partnerNameInput.value.trim() || 'dein Partner';
    const mood = state.lastMood || 'ruhig';
    const moodMeta = moods.find(m => m.id === mood) || moods[0];
    const energy = Number(document.getElementById('energy').value) || 5;
    const topic = document.getElementById('topic').value.trim();
    const talkIntent = document.getElementById('talkIntent').value;
    const createdAt = Date.now();

    const entry = {
      id: crypto.randomUUID ? crypto.randomUUID() : `${createdAt}-${Math.random()}`,
      author,
      partner,
      mood,
      moodLabel: moodMeta.label,
      emoji: moodMeta.emoji,
      energy,
      talkIntent,
      topic,
      createdAt
    };

    state.entries.push(entry);
    state.meName = author;
    state.partnerName = partner === 'dein Partner' ? '' : partner;
    persist();
    hydrateForm();
    renderFilters();
    renderEntries();
    refreshQuestions();
  }

  function refreshQuestions(){
    const mood = state.lastMood;
    const pool = questionPool[mood] || questionPool.fallback;
    const shuffled = [...pool].sort(()=>Math.random()-0.5);
    const picked = shuffled.slice(0,3);

    questionBox.innerHTML = '';
    picked.forEach(q => {
      const node = document.createElement('div');
      node.className = 'question';
      node.textContent = q;
      questionBox.appendChild(node);
    });
  }

  function buildSummary(entry){
    const intro = `${entry.author} f√ºhlt sich ${entry.moodLabel.toLowerCase()} (${entry.energy}/10 Energie).`;
    const ask = entry.talkIntent === 'nur Info'
      ? 'Keine Antwort n√∂tig, einfach nur teilen.'
      : `Wunsch: ${entry.talkIntent}.`;
    const topic = entry.topic ? `Notiz: "${entry.topic}".` : 'Keine extra Notiz.';
    return `${intro} ${topic} ${ask}`;
  }

  async function copySummary(){
    const list = state.entries.sort((a,b)=>b.createdAt-a.createdAt);
    if(list.length === 0) return;
    const text = buildSummary(list[0]);
    try{
      await navigator.clipboard.writeText(text);
      summaryCard.insertAdjacentHTML('beforeend','<div class="subtle">In die Zwischenablage kopiert.</div>');
    }catch(e){
      summaryCard.insertAdjacentHTML('beforeend','<div class="subtle">Kopieren nicht m√∂glich. Bitte manuell markieren.</div>');
    }
  }
})();
</script>

<!-- Service Worker Registrierung -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js').then(reg => {
      function readyToActivate(sw) {
        if (sw && sw.state === 'installed') {
          if (navigator.serviceWorker.controller) {
            sw.postMessage({ type: 'SKIP_WAITING' });
          }
        }
      }
      if (reg.waiting) readyToActivate(reg.waiting);
      reg.addEventListener('updatefound', () => {
        const sw = reg.installing;
        sw && sw.addEventListener('statechange', () => readyToActivate(sw));
      });
      let refreshing = false;
      navigator.serviceWorker.addEventListener('controllerchange', () => {
        if (refreshing) return;
        refreshing = true;
        window.location.reload();
      });
    }).catch(console.error);
  });
}
</script>
</body>
</html>
